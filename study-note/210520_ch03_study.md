# 3 ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œ JPAë¡œ DB ë‹¤ë£¨ê¸°
SQLì„ ë‹¤ë£¨ëŠ” ê²ƒì„ ì‰½ê²Œ í•˜ê¸°ìœ„í•´ ë‚˜ì˜¨ JPA   
JPAëŠ” ìë°” í‘œì¤€ ORM(Object Relational Mapping) ê¸°ìˆ 
## 3.1 JPA ì†Œê°œ
ê¸°ì¡´ì—ëŠ” SQL ë•Œë¬¸ì—(?)...   
1. ë‹¨ìˆœ ë°˜ë³µ ì‘ì—…ì˜ ë¬¸ì œ
2. íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜ ë¬¸ì œ
	* ê´€ê³„í˜• DBëŠ” 'ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ì €ì¥' í• ì§€ì— ì´ˆì²¨
	* ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ëŠ” 'ê¸°ëŠ¥ê³¼ ì†ì„±ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬' í•˜ëŠ” ê¸°ìˆ 
	* ì¦‰, ë‹¤ë¥¸ íŒ¨ëŸ¬ë‹¤ì„ìœ¼ë¡œ ì¸í•´ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ë ¤ê³  í•˜ë‹ˆ ì—¬ëŸ¬ ë¬¸ì œê°€ ë°œìƒí•˜ê³  
	ì´ë¥¼ **íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜** ë¼ê³  í•¨

```java
//ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì—ì„œ ë¶€ëª¨ê°€ ë˜ëŠ” ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´...
User user = findUser();
Group group = user.getGroup();
//ë”± ë³´ë©´ Userì™€ Groupì´ ë¶€ëª¨-ìì‹ ê´€ê³„ì„ì„ ì•Œ ìˆ˜ ìˆìŒ

//ê·¸ë ‡ë‹¤ë©´ ì—¬ê¸°ì— DBê°€ ì¶”ê°€ë˜ë©´...
User user = userDao.findUser();
Group group = groupDao.findGroup(user.getGroupId());
//User ë”°ë¡œ, Group ë”°ë¡œ ì¡°íšŒ
//ì–´ë–¤ ê´€ê³„ì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ
```

ì´ë ‡ë‹¤ ë³´ë‹ˆ ê°œë°œì€ ì ì  ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§ì—ë§Œ ì§‘ì¤‘í•˜ê²Œ ë¨   
ì´ ë¬¸ì œ í•´ê²° ìœ„í•´ JPA ë“±ì¥   
ì¦‰, ì¤‘ê°„ì—ì„œ íŒ¨ëŸ¬ë‹¤ì„ ì¼ì¹˜ë¥¼ ìœ„í•œ ê¸°ìˆ 

### ìš”êµ¬ì‚¬í•­ ë¶„ì„
ì‹¤ìŠµì„ ìœ„í•œ ìš”êµ¬ì‚¬í•­ ë¶„ì„   
ì´ ì±…ì˜ ëª©í‘œëŠ” ì•ìœ¼ë¡œ 3ì¥ ~ 6ì¥ê¹Œì§€ í•˜ë‚˜ì˜ ê²Œì‹œíŒ ë§Œë“¤ì–´ë³´ê³  
7ì¥ ~ 10ì¥ê¹Œì§€ ì´ ì„œë¹„ìŠ¤ë¥¼ AWSì— ë¬´ì¤‘ë‹¨ ë°°í¬í•˜ëŠ” ê²ƒ ê¹Œì§€ ì§„í–‰
#### ê²Œì‹œíŒ ê¸°ëŠ¥
* ê²Œì‹œê¸€ ì¡°íšŒ
* ê²Œì‹œê¸€ ë“±ë¡
* ê²Œì‹œê¸€ ìˆ˜ì •
* ê²Œì‹œê¸€ ì‚­ì œ
#### íšŒì› ê¸°ëŠ¥
* êµ¬ê¸€.ë„¤ì´ë²„ ë¡œê·¸ì¸
* ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ê¸€ ì‘ì„± ê¶Œí•œ
* ë³¸ì¸ ì‘ì„± ê¸€ì— ëŒ€í•œ ê¶Œí•œ ê´€ë¦¬

## 3.2 í”„ë¡œì íŠ¸ì— Spring Data Jpa ì ìš©í•˜ê¸°
build.gradleì— ì•„ë˜ì™€ ê°™ì´ ì…ë ¥í•´ì•¼ JPA ì‚¬ìš© ê°€ëŠ¥
```groovy
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
runtimeOnly 'com.h2database:h2'
```
### Posts í´ë˜ìŠ¤ ë§Œë“¤ê¸°
Posts í´ë˜ìŠ¤ì—ëŠ” Setter ë©”ì†Œë“œê°€ ì—†ìŒ   
ì´ìœ ëŠ” getter/setterë¥¼ ë¬´ì‘ì • ìƒì„±í•˜ê²Œë˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ ê°’ë“¤ì´ ì–¸ì œ ì–´ë””ì„œ ë³€í•´ì•¼ í•˜ëŠ”ì§€
ì½”ë“œìƒìœ¼ë¡œ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ì›Œ, ì°¨í›„ ê¸°ëŠ¥ ë³€ê²½ì‹œ ë³µì¡í•´ì§€ê¸° ë•Œë¬¸   

ê·¸ë ‡ë‹¤ë©´ setterê°€ ì—†ëŠ” ìƒíƒœì—ì„œ **ì–´ë–»ê²Œ ê°’ì„ ì±„ì›Œ DBì— ì‚½ì…**í•´ì•¼ í•˜ëŠ”ê°€?   

ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” **ìƒì„±ìë¥¼ í†µí•´** ìµœì¢… ê°’ì„ ì±„ìš´ í›„ DBì— ì‚½ì…í•˜ëŠ” ê²ƒ   
ê°’ ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš° í•´ë‹¹ **ì´ë²¤íŠ¸ì— ë§ëŠ” public ë©”ì†Œë“œë¥¼ í˜¸ì¶œ**í•˜ì—¬ ë³€ê²½í•˜ëŠ” ê²ƒì„ ì „ì œë¡œ í•¨

### PostRepository ì¸í„°í˜ì´ìŠ¤ ë§Œë“¤ê¸°
PostRepositoryëŠ” Posts í´ë˜ìŠ¤ë¡œ DBë¥¼ ì ‘ê·¼í•˜ê²Œ í•´ì¤„ JpaRepositoryì„

## 3.3 Spring Data JPA í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ê¸°
### issue
application.propertiesì— sql ì¿¼ë¦¬ ë¡œê·¸ ë³´ê¸° ìœ„í•´ì„œ ì‘ì„±í•˜ëŠ”ê²Œ ì±…ì´ë‘ ì¢€ ë‹¬ë¼ì„œ ê¸€ ë‚¨ê¹ë‹ˆë‹¤.
```groovy
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLInnoDBDialect
```
ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ê²Œ gitì—ì„œ issueë¥¼ ê²€ìƒ‰í•´ë³´ë‹ˆê¹ spring 2.1.x? ì´ ë²„ì „ ìƒìœ„ ë²„ì „ì—ì„œëŠ” ë°‘ì—ì²˜ëŸ¼ 
ë³µì¡í•˜ê²Œ ì‘ì„±í•´ì•¼ í•œë‹¤ê³  í•˜ë„¤ìš”ã… ã… ã…    
(ì €ëŠ” ì„¤ì • ë‹¤ ë”°ë¼ì¹˜ê¸° ê·€ì°®ì•„ì„œ ê·¸ëƒ¥ spring boot starterë¡œ ë¹ ë¥´ê²Œ ë§Œë“¤ì–´ ë²„ë ¸ì–´ìš”ğŸ˜‚)
```groovy
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect
spring.jpa.properties.hibernate.dialect.storage_engine=innodb
spring.datasource.hikari.jdbc-url=jdbc:h2:mem://localhost/~/testdb;MODE=MYSQL
```

## 3.4 ë“±ë¡/ìˆ˜ì •/ì¡°íšŒ API ë§Œë“¤ê¸°
APIë¥¼ ë§Œë“¤ê¸° ìœ„í•´ í•„ìš”í•œ í´ë˜ìŠ¤
1. Request ë°ì´í„°ë¥¼ ë°›ì€ Dto
2. API ìš”ì²­ì„ ë°›ì„ Controller
3. íŠ¸ëœì­ì…˜, ë„ë©”ì¸ ê¸°ëŠ¥ ê°„ì˜ ìˆœì„œë¥¼ ë³´ì¥í•˜ëŠ” Service

### Spring ì›¹ ê³„ì¸µ
1. Web Layer
	* ì™¸ë¶€ ìš”ì²­ê³¼ ì‘ë‹µì— ëŒ€í•œ ì „ë°˜ì ì¸ ì˜ì—­
	
2. Service Layer
	* ì¼ë°˜ì ìœ¼ë¡œ Controllerì™€ Daoì˜ ì¤‘ê°„ ì˜ì—­ì—ì„œ ì‚¬ìš©
	
3. Repository Layer
	* DBì™€ ê°™ì´ ë°ì´í„° ì €ì¥ì†Œì— ì ‘ê·¼í•˜ëŠ” ì˜ì—­
	
4. Dtos
	 * Dto(Data Transfer Object)ëŠ” **ê³„ì¸µ ê°„ì— ë°ì´í„° êµí™˜ì„ ìœ„í•œ ê°ì²´**ë¥¼ ë§í•¨
	* DtosëŠ” ì´ë“¤ì˜ ì˜ì—­ì„ ë§í•¨
	
5. Domain Model
	* ë„ë©”ì¸ì´ë¼ ë¶ˆë¦¬ëŠ” ê°œë°œ ëŒ€ìƒì„ ëª¨ë“  ì‚¬ëŒì´ ë™ì¼í•œ ê´€ì ì—ì„œ ì´í•´í•  ìˆ˜ ìˆê³  ê³µìœ í•  ìˆ˜ ìˆë„ë¡ ë‹¨ìˆœí™”ì‹œí‚¨ ê²ƒ   
	
### ë“±ë¡ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼
![img.png](img.png)   

### ìˆ˜ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼
update testì—ì„œ ë§¤ì¹˜ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ ë°œìƒ   

---
2021.05.21 ë¬¸ì œ í•´ê²°   
```java
//PostsService.java
@Transactional
public Long update(Long id, PostsUpdateRequestDto requestDto){
    Posts posts = postsRepository.findById(id).orElseThrow(
            () -> new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. id = " + id)
    );
    posts.update(requestDto.getTitle(), requestDto.getContent()); //ì´ ì¤„ì´ ë¹ ì ¸ìˆì—ˆã……...
    return id;
}
```
